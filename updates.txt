CommStat - Summary of Changes and Improvements
========================================================

Project rebuild and modernization effort - December 2025


1. NEW MAIN APPLICATION (commstat2.py)
--------------------------------------
- Complete rebuild of commstat.py using Python best practices
- Clean class-based architecture:
  - ConfigManager: Handles config.ini loading with validation
  - DatabaseManager: Centralized SQLite operations
  - MainWindow: PyQt5 GUI with organized component setup
- Type hints and docstrings throughout
- Constants defined at top of file (no magic numbers/strings)
- Color validation with fallback to defaults for invalid config values
- Menu bar styling with configurable colors and centered text
- Filter labels use size policy to allow window resizing
- 20-second auto-refresh for StatRep, bulletins, live feed, and map


2. DATAREADER REFACTORING (datareader.py)
-----------------------------------------
- Reduced from 675 to ~620 lines while adding features
- Replaced 7 global variables with Config class
- Consolidated 4+ database connections into single connection
- Created helper methods to eliminate code duplication:
  - extract_callsign(): Replaces 6 duplicated blocks
  - parse_statrep_fields(): Parses 12-character status code
  - validate_statrep_fields(): Validates all fields in one call
- Added constants for message type markers:
  - MSG_BULLETIN = "{^%}"
  - MSG_STATREP = "{&%}"
  - MSG_FORWARDED_STATREP = "{F%}"
  - MSG_MARQUEE = "{*%}"
  - MSG_CHECKIN = "{~%}"
- Removed unused imports (numpy, re)
- Removed 100+ lines of commented/dead code
- Added type hints and docstrings


3. MODULE INTEGRATION (datareader + commstat2)
----------------------------------------------
- datareader imported as module instead of subprocess call
- Parser instance persists in memory between refresh cycles
- Added timestamp tracking to skip already-processed lines:
  - First run: processes last 50 lines (sets baseline)
  - Subsequent runs: only processes NEW lines
- Much cleaner terminal output - only shows genuinely new messages
- No subprocess overhead every 20 seconds


4. CROSS-PLATFORM PATH HANDLING
-------------------------------
- Replaced OS-specific path separators with os.path.join()
- Works on Windows, Linux, and macOS without code changes
- Simplified _detect_os() to _log_os_info() (just logs OS name)


5. CONFIGURATION IMPROVEMENTS
-----------------------------
- Created config.ini.template with default settings
- Created traffic.db3.template with test data
- install.py creates files from templates if missing
- User configs preserved during updates
- .gitignore updated to track templates but ignore user files
- Renamed 'port' to 'UDP_port' for clarity (15 Python files updated)


6. INSTALL.PY UPDATES
---------------------
- Added psutil to package list
- Refactored to use list iteration instead of individual variables
- Added create_from_template() function
- Added setup_files() to create config and database from templates


7. UI IMPROVEMENTS
------------------
- Menu bar: 24px height with 4px padding for centered text
- Menu colors configurable via config.ini (menu_background, menu_foreground)
- Filter labels allow window to be narrowed (QSizePolicy.Ignored)
- Color validation: invalid colors fall back to defaults with warning


8. CODE QUALITY
---------------
- Type hints on all function parameters and returns
- Docstrings on all classes and key methods
- Constants replace magic numbers and strings
- Single responsibility principle applied
- Dependency injection (config/db managers passed to components)
- Error handling with graceful failures
- f-strings for consistent string formatting
- Private methods use _ prefix


9. FILES MODIFIED
-----------------
- commstat2.py (NEW - main application rebuild)
- datareader.py (refactored)
- install.py (updated)
- config.ini.template (NEW)
- traffic.db3.template (NEW)
- .gitignore (updated)
- bulletin.py, checkin.py, csresponder.py, filter.py, heardlist.py,
  js8mail.py, js8sms.py, marquee.py, members.py, netmanager.py,
  settings.py, statack.py, statrep.py (UDP_port rename)


10. GIT COMMITS
---------------
- Add commstat2.py - rebuilt application with best practices
- Refactor datareader.py with Python best practices
- Use os.path.join for cross-platform path handling
- Add psutil to install.py and clean up package installation
- Add color validation and menu bar styling improvements
- Add template files and rename port to UDP_port
- Fix filter labels blocking resize and add datareader call
- Import datareader as module with timestamp tracking
